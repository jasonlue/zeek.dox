<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>zeek: README</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">zeek
   &#160;<span id="projectnumber">4.2.0</span>
   </div>
   <div id="projectbrief">github.com/zeek/zeek</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">README </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1 align="center">ZAM Optimization: User's Guide </h1>
<h4 align="center"><a href="../../#overview"><em>Overview</em></a> - <a href="../../#known-issues"><em>Known Issues</em></a> - <a href="../../#script-optimization-options"><em>Optimization Options</em></a> - </h4>
<p><br  />
</p>
<h2><a class="anchor" id="autotoc_md3"></a>
Overview</h2>
<p>Zeek's <em>ZAM optimization</em> is an experimental feature that changes the basic execution model for Zeek scripts in an effort to gain higher performance. Normally, Zeek parses scripts into <em>Abstract Syntax Trees</em> that are then executed by recursively interpreting each node in a given tree. <a class="el" href="../../db/d1b/sqlite3_8c.html#df/d70/structWith">With</a> script optimization, Zeek compiles the trees into a low-level form that can generally be executed more efficiently.</p>
<p>You specify use of this feature by including <code>-O ZAM</code> on the command line. (Note that this option takes a few seconds to generate the ZAM code, unless you're using <code>-b</code> <em>bare mode</em>.)</p>
<p>How much faster will your scripts run? There's no simple answer to that. It depends heavily on several factors:</p>
<ul>
<li>What proportion of the processing during execution is spent in Zeek's <em>Event Engine</em> rather than executing scripts. ZAM optimization doesn't help with Event Engine execution.</li>
<li>What proportion of the script's processing is spent executing built-in functions (BiFs). ZAM optimization improves execution for some select, <em>simple</em> BiFs, like <code><a class="el" href="../../da/dee/namespacezeek_1_1run__state.html#a30d9d14d2de95e2f18d725065711ec55">network_time()</a></code>, but it doesn't help for complex BiFs. It might well be that most of your script processing actually occurs inside the <em>Logging Framework</em>, for example, and thus you won't see much improvement.</li>
<li>Those two factors add up to gains very often on the order of only 10-15%, rather than something a lot more dramatic.</li>
<li>In addition, there are some <a href="../../#Scripts-that-cannot-be-compiled">types of scripts that currently can't be compiled</a>, and thus will remain interpreted. If your processing bottlenecks in such scripts, you won't see much in the way of gains.</li>
</ul>
<p><br  />
</p>
<h2><a class="anchor" id="autotoc_md4"></a>
Known Issues</h2>
<p>Here we list various issues with using script optimization, including both deficiencies (problems to eventually fix) and incompatibilities (differences in behavior from the default of script interpretation, not necessarily fixable). For each, the corresponding list is roughly ordered from you're-most-likely-to-care-about-it to you're-less-likely-to-care, though of course this varies for different users. <br  />
</p>
<h3><a class="anchor" id="autotoc_md5"></a>
Deficiencies to eventually fix:</h3>
<ul>
<li>Error messages in compiled scripts often lack important identifying information.</li>
<li>The optimizer assumes you have ensured initialization of your variables. If your script uses a variable that hasn't been set, the compiled code may crash or behave aberrantly. You can use the <code>-u</code> command-line flag to find such potential usage issues.</li>
<li>Certain complex "when" expressions may fail to reevaluate when elements of the expression are modified by compiled scripts.</li>
</ul>
<p><br  />
</p>
<h3><a class="anchor" id="autotoc_md6"></a>
Incompatibilities:</h3>
<ul>
<li>When printing scripts (such as in some error messages), the names of variables often reflect internal temporaries rather than the original variables.</li>
<li>The deprecated feature of intermixing vectors and scalars in operations (e.g., <code>v2 = v1 * 3</code>) is not supported.</li>
<li>The <code>same_object()</code> BiF will always deem two non-container values as different.</li>
</ul>
<p><br  />
</p>
<h3><a class="anchor" id="autotoc_md7"></a>
Scripts that cannot be compiled:</h3>
<p>The ZAM optimizer does not compile scripts that include "when" statements or lambda expressions. These will take substantial work to support. It also will not inline such scripts, nor will it inline scripts that are either directly or indirectly recursive.</p>
<p>You can get a list of non-compilable scripts using <code>-O ZAM -O report-uncompilable</code>. For recursive scripts, use <code>-O report-recursive</code> (no <code>-O ZAM</code> required, since it doesn't apply to the alternative optimization, <code>-O gen-C++</code>).</p>
<p><br  />
</p>
<h2><a class="anchor" id="autotoc_md8"></a>
Script Optimization Options</h2>
<p>Users will generally simply use <code>-O ZAM</code> to invoke the script optimizer. There are, however, a number of additional options, nearly all of which only have relevance for those debugging optimization problems or performance issues:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Option   </th><th class="markdownTableHeadNone">Meaning    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>dump-uds</code>   </td><td class="markdownTableBodyNone">Dump use-defs to <em>stdout</em>.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>dump-xform</code>   </td><td class="markdownTableBodyNone">Dump transformed scripts to <em>stdout</em>.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>dump-ZAM</code>   </td><td class="markdownTableBodyNone">Dump generated ZAM code to <em>stdout</em>.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>help</code>   </td><td class="markdownTableBodyNone">Print this list.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>inline</code>   </td><td class="markdownTableBodyNone">Inline function calls.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>no-ZAM-opt</code>   </td><td class="markdownTableBodyNone">Turn off low-level ZAM optimization.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>optimize-all</code>   </td><td class="markdownTableBodyNone">Optimize all scripts, even inlined ones. You need to separately specify which optimizations you want to apply, e.g., <code>-O inline -O xform</code>.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>optimize-AST</code>   </td><td class="markdownTableBodyNone">Optimize the (transform) AST; implies <code>xform</code>.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>profile-ZAM</code>   </td><td class="markdownTableBodyNone">Generate to <em>stdout</em> a ZAM execution profile. (Requires configuring with <code>--enable-debug</code>.)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>report-recursive</code>   </td><td class="markdownTableBodyNone">Report on recursive functions and exit.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>report-uncompilable</code>   </td><td class="markdownTableBodyNone">Report on uncompilable functions and exit.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>xform</code>   </td><td class="markdownTableBodyNone">Transform scripts to "reduced" form.   </td></tr>
</table>
<p><br  />
 <br  />
 </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
